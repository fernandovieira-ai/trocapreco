<ion-content [fullscreen]="true" class="login-content">
  <!-- Background animated -->
  <div class="animated-background"></div>

  <!-- Login Container -->
  <div class="login-container">
    <div class="login-box">
      <!-- Header com Logo -->
      <div class="login-header">
        <div class="logo-container">
          <img
            src="../../assets/logo.png"
            alt="Logo DIGITALRF"
            class="logo"
            (error)="onLogoError($event)"
          />
          <h1 *ngIf="!logoLoaded" class="logo-text">DIGITALRF</h1>
        </div>
        <p class="subtitle">Faça login para acessar</p>
      </div>

      <!-- Formulário -->
      <form class="login-form" (ngSubmit)="login()">
        <!-- Campo Usuário -->
        <div class="form-group">
          <label for="usuario">Usuário</label>
          <input
            type="text"
            id="usuario"
            [(ngModel)]="user.nom_usuario"
            name="usuario"
            required
            autocomplete="username"
            [disabled]="loading"
          />
        </div>

        <!-- Campo Senha -->
        <div class="form-group">
          <label for="senha">Senha</label>
          <div class="input-password-wrapper">
            <input
              [type]="mostrarSenha ? 'text' : 'password'"
              id="senha"
              [(ngModel)]="senha"
              name="senha"
              required
              autocomplete="current-password"
              (keyup.enter)="login()"
              [disabled]="loading"
            />
            <button
              type="button"
              class="toggle-password"
              (click)="mostrarSenha = !mostrarSenha"
              [attr.aria-label]="mostrarSenha ? 'Ocultar senha' : 'Mostrar senha'"
              tabindex="-1"
            >
              <ion-icon
                [name]="mostrarSenha ? 'eye-off-outline' : 'eye-outline'"
              ></ion-icon>
            </button>
          </div>
        </div>

        <!-- Checkbox Lembrar -->
        <div class="form-group checkbox-group">
          <label>
            <input
              type="checkbox"
              id="lembrar"
              name="lembrar"
              [(ngModel)]="lembrarSenha"
            />
            Lembrar-me
          </label>
        </div>

        <!-- Botão Entrar -->
        <button
          type="submit"
          class="btn-login"
          [disabled]="!user.nom_usuario || !senha || loading"
        >
          <span *ngIf="!loading">Entrar</span>
          <span *ngIf="loading" class="loading-spinner">
            <ion-spinner name="crescent"></ion-spinner>
          </span>
        </button>

        <!-- Mensagem de Feedback -->
        <div
          *ngIf="loginMessage"
          class="mensagem"
          [ngClass]="loginMessage.type === 'error' ? 'erro' : 'sucesso'"
        >
          {{ loginMessage.text }}
        </div>
      </form>

      <!-- Footer -->
      <div class="login-footer">
        <a href="#" class="link-recuperar">Esqueceu a senha?</a>
      </div>
    </div>

    <!-- Versão -->
    <div class="version-info" *ngIf="currentVersion">
      <span>Build {{ currentVersion }}</span>
      <ion-badge *ngIf="hasUpdate" color="danger" (click)="forcarAtualizacao()">
        Atualização disponível
      </ion-badge>
    </div>
  </div>
</ion-content>
