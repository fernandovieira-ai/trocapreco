<ion-header [translucent]="true" mode="ios" class="custom-header">
  <ion-toolbar class="main-toolbar">
    <!-- Título e informações do usuário -->
    <div class="header-content">
      <div class="user-section">
        <div class="user-avatar">
          <ion-icon name="person-circle-outline"></ion-icon>
        </div>
        <div class="user-info">
          <h1 class="welcome-text">Olá, {{auth.userLogado?.nom_usuario}}</h1>
          <p class="company-text">{{auth.userLogado?.des_rede}}</p>
        </div>
      </div>

      <!-- Botões de ação -->
      <div class="header-actions">
        <ion-chip
          *ngIf="auth.userLogado.cod_usuario === 466"
          class="action-chip update-chip"
          (click)="atualizaRegistro()"
        >
          <ion-icon name="cloud-download"></ion-icon>
          <ion-label>Atualizar</ion-label>
        </ion-chip>
        <ion-chip
          *ngIf="auth.userLogado.cod_usuario === 466"
          class="action-chip users-chip"
          (click)="setOpen(true)"
        >
          <ion-icon name="people-outline"></ion-icon>
          <ion-label>Usuários</ion-label>
        </ion-chip>
        <ion-chip class="action-chip logout-chip" (click)="logout()">
          <ion-icon name="log-out-outline"></ion-icon>
          <ion-label>Sair</ion-label>
        </ion-chip>
      </div>
    </div>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" mode="ios" class="home-content">
  <!-- Gradiente de fundo -->
  <div class="gradient-overlay"></div>

  <!-- Conteúdo principal -->
  <div class="content-wrapper" [ngClass]="{'desktop-mode': !auth.isMobile}">
    <!-- Card de Seleção de Empresas -->
    <div class="info-card">
      <div class="card-header">
        <ion-icon name="business-outline" class="card-icon"></ion-icon>
        <div class="card-title-section">
          <h2 class="card-title">Empresas</h2>
          <p class="card-subtitle">Selecione as empresas para trabalhar</p>
        </div>
      </div>

      <ion-button
        expand="block"
        fill="outline"
        class="select-button"
        id="open-modal-empresas"
      >
        <ion-icon slot="start" name="apps-outline"></ion-icon>
        Selecionar Empresas
        <ion-icon slot="end" name="chevron-forward-outline"></ion-icon>
      </ion-button>

      <!-- Badge de empresas selecionadas -->
      <div
        *ngIf="auth.userLogado.cod_empresa_usuario?.length > 0"
        class="selected-badge"
      >
        <ion-badge color="success">
          {{auth.userLogado.cod_empresa_usuario.length}} empresa(s)
          selecionada(s)
        </ion-badge>
      </div>
    </div>

    <!-- Seção de Funcionalidades -->
    <div class="section-header">
      <h2 class="section-title">Funcionalidades</h2>
      <p class="section-subtitle">O que vamos realizar hoje?</p>
    </div>

    <!-- Grid de Funcionalidades -->
    <div class="features-grid">
      <!-- Troca de Preços -->
      <div
        class="feature-card"
        routerLink="/home/precobomba"
        [class.disabled]="auth.userLogado.cod_empresa_usuario.length <= 0"
      >
        <div class="feature-icon-container primary">
          <ion-icon name="swap-horizontal-outline"></ion-icon>
        </div>
        <div class="feature-content">
          <h3 class="feature-title">Troca de Preços</h3>
          <p class="feature-description">Altere seus preços de bomba</p>
        </div>
        <ion-icon name="chevron-forward" class="feature-arrow"></ion-icon>
      </div>

      <!-- Inclusão de Negociações -->
      <div
        class="feature-card"
        routerLink="/home/filtro"
        [class.disabled]="auth.userLogado.cod_empresa_usuario.length <= 0"
      >
        <div class="feature-icon-container success">
          <ion-icon name="add-circle-outline"></ion-icon>
        </div>
        <div class="feature-content">
          <h3 class="feature-title">Inclusão de Negociações</h3>
          <p class="feature-description">Crie novas negociações de preços</p>
        </div>
        <ion-icon name="chevron-forward" class="feature-arrow"></ion-icon>
      </div>

      <!-- Aprovação de Negociações -->
      <div
        class="feature-card"
        routerLink="/home/aprovacao-negociacao"
        [class.disabled]="auth.userLogado.cod_empresa_usuario.length <= 0"
      >
        <div class="feature-icon-container warning">
          <ion-icon name="checkmark-circle-outline"></ion-icon>
        </div>
        <div class="feature-content">
          <h3 class="feature-title">Aprovação de Negociações</h3>
          <p class="feature-description">
            Aprove ou rejeite negociações pendentes
          </p>
        </div>
        <ion-icon name="chevron-forward" class="feature-arrow"></ion-icon>
      </div>

      <!-- Histórico -->
      <div
        class="feature-card"
        routerLink="/home/historico"
        [class.disabled]="auth.userLogado.cod_empresa_usuario.length <= 0"
      >
        <div class="feature-icon-container info">
          <ion-icon name="time-outline"></ion-icon>
        </div>
        <div class="feature-content">
          <h3 class="feature-title">Histórico</h3>
          <p class="feature-description">Visualize o histórico de alterações</p>
        </div>
        <ion-icon name="chevron-forward" class="feature-arrow"></ion-icon>
      </div>

      <!-- Atualização de Filtros -->
      <div
        class="feature-card"
        routerLink="/home/filtro-atualizacao"
        [class.disabled]="auth.userLogado.cod_empresa_usuario.length <= 0"
      >
        <div class="feature-icon-container secondary">
          <ion-icon name="filter-outline"></ion-icon>
        </div>
        <div class="feature-content">
          <h3 class="feature-title">Atualização de Filtros</h3>
          <p class="feature-description">Gerencie filtros de consulta</p>
        </div>
        <ion-icon name="chevron-forward" class="feature-arrow"></ion-icon>
      </div>

      <!-- Atualização de Preços -->
      <div
        class="feature-card"
        routerLink="/home/preco-atualizacao"
        [class.disabled]="auth.userLogado.cod_empresa_usuario.length <= 0"
      >
        <div class="feature-icon-container tertiary">
          <ion-icon name="pricetag-outline"></ion-icon>
        </div>
        <div class="feature-content">
          <h3 class="feature-title">Atualização de Preços</h3>
          <p class="feature-description">Atualize preços rapidamente</p>
        </div>
        <ion-icon name="chevron-forward" class="feature-arrow"></ion-icon>
      </div>
    </div>
  </div>

  <!-- Modal de Seleção de Empresas -->
  <ion-modal trigger="open-modal-empresas" mode="ios" class="empresa-modal">
    <ng-template>
      <ion-header>
        <ion-toolbar class="modal-toolbar">
          <ion-title>Seleção de Empresas</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="cancel()">
              <ion-icon slot="icon-only" name="close"></ion-icon>
            </ion-button>
          </ion-buttons>
        </ion-toolbar>
        <ion-toolbar>
          <ion-searchbar
            [debounce]="300"
            (ionInput)="pesquisaEmpresa($event)"
            animated="true"
            placeholder="Buscar por nome ou código"
            class="custom-searchbar"
          >
          </ion-searchbar>
        </ion-toolbar>
      </ion-header>

      <ion-content class="modal-content">
        <div class="empresa-list">
          <div *ngFor="let item of empresasFiltradas" class="empresa-item">
            <div class="empresa-info">
              <h3 class="empresa-nome">{{item.nom_fantasia}}</h3>
              <p class="empresa-codigo">Código: {{item.cod_empresa}}</p>
            </div>
            <ion-checkbox
              [checked]="item.ind_selecionado"
              (ionChange)="selecaoEmpresa($event, item)"
              class="custom-checkbox"
            >
            </ion-checkbox>
          </div>
        </div>
      </ion-content>

      <ion-footer class="modal-footer">
        <div class="footer-actions">
          <ion-button
            expand="block"
            fill="outline"
            (click)="marcarTodosItens()"
          >
            <ion-icon slot="start" name="checkmark-done-outline"></ion-icon>
            Marcar Todas
          </ion-button>
          <ion-button
            expand="block"
            fill="outline"
            color="danger"
            (click)="desmarcarTodosItens()"
          >
            <ion-icon slot="start" name="close-outline"></ion-icon>
            Desmarcar Todas
          </ion-button>
        </div>
      </ion-footer>
    </ng-template>
  </ion-modal>

  <!-- Modal de Usuários (Admin) -->
  <ion-modal [isOpen]="isModalOpenUser" mode="ios" class="users-modal">
    <ng-template>
      <ion-header>
        <ion-toolbar class="modal-toolbar">
          <ion-title>Gerenciar Usuários</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="setOpen(false)">
              <ion-icon slot="icon-only" name="close"></ion-icon>
            </ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>

      <ion-content class="modal-content">
        <!-- Conteúdo do modal de usuários mantido do original -->
        <!-- Adicione aqui o conteúdo existente do modal de usuários -->
      </ion-content>
    </ng-template>
  </ion-modal>
</ion-content>
