<ion-content [fullscreen]="true" class="login-container">
  <!-- Gradiente de fundo -->
  <div class="gradient-background"></div>

  <!-- Canvas de partículas (opcional, mantido do design anterior) -->
  <canvas #particlesCanvas class="particles-canvas"></canvas>

  <!-- Container principal centralizado -->
  <div class="login-wrapper">
    
    <!-- Header com logo e versão -->
    <div class="header-section">
      <div class="logo-container">
        <ion-img src="../../assets/LOGO-TROCA-PRECO.png" class="app-logo"></ion-img>
      </div>
      <h1 class="app-title">DIGITALRF</h1>
      <p class="app-subtitle">Troca de Preços</p>
      
      <!-- Badge de versão -->
      <ion-chip class="version-chip" (click)="forcarAtualizacao()" color="light">
        <ion-icon name="rocket-outline"></ion-icon>
        <ion-label>Build {{currentVersion}}</ion-label>
        <ion-badge *ngIf="hasUpdate" color="danger" class="update-badge">!</ion-badge>
      </ion-chip>
    </div>

    <!-- Card de login -->
    <div class="login-card">
      
      <!-- Mensagem de feedback -->
      <div *ngIf="loginMessage" class="message-container" [ngClass]="'message-' + loginMessage.type">
        <ion-icon [name]="loginMessage.type === 'error' ? 'alert-circle' : 
                         loginMessage.type === 'success' ? 'checkmark-circle' : 'information-circle'">
        </ion-icon>
        <span>{{ loginMessage.text }}</span>
      </div>

      <!-- Formulário de login -->
      <form class="login-form">
        
        <!-- Campo usuário -->
        <div class="input-wrapper">
          <label class="input-label">Usuário</label>
          <div class="input-container" [class.focused]="usernameFocused">
            <ion-icon name="person-outline" class="input-icon"></ion-icon>
            <ion-input
              [(ngModel)]="user.nom_usuario"
              name="usuario"
              type="text"
              placeholder="Digite seu usuário"
              class="custom-input"
              (ionFocus)="usernameFocused = true"
              (ionBlur)="usernameFocused = false">
            </ion-input>
          </div>
        </div>

        <!-- Campo senha -->
        <div class="input-wrapper">
          <label class="input-label">Senha</label>
          <div class="input-container" [class.focused]="passwordFocused">
            <ion-icon name="lock-closed-outline" class="input-icon"></ion-icon>
            <ion-input
              [(ngModel)]="senha"
              name="senha"
              [type]="mostrarSenha ? 'text' : 'password'"
              placeholder="Digite sua senha"
              class="custom-input"
              (keyup.enter)="login()"
              (ionFocus)="passwordFocused = true"
              (ionBlur)="passwordFocused = false">
            </ion-input>
            <ion-icon 
              [name]="mostrarSenha ? 'eye-off-outline' : 'eye-outline'" 
              class="toggle-password-icon"
              (click)="mostrarSenha = !mostrarSenha">
            </ion-icon>
          </div>
        </div>

        <!-- Botão de login -->
        <ion-button
          expand="block"
          class="login-button"
          [disabled]="!user.nom_usuario || !senha || loading"
          (click)="login()">
          <ion-spinner *ngIf="loading" name="crescent"></ion-spinner>
          <span *ngIf="!loading">Entrar</span>
        </ion-button>

      </form>

      <!-- Avisos de instalação PWA -->
      <div class="pwa-section" *ngIf="deferredPrompt && authservice.isAndroid">
        <div class="pwa-message">
          <ion-icon name="download-outline" class="pwa-icon"></ion-icon>
          <p>Detectamos um dispositivo Android</p>
          <p class="pwa-text-small">Instale o App e tenha a melhor experiência</p>
        </div>
        <ion-button expand="block" fill="outline" class="install-button" (click)="installPWA()">
          <ion-icon slot="start" name="download"></ion-icon>
          Instalar App
        </ion-button>
      </div>

      <div class="pwa-section" *ngIf="authservice.isIOS && !isStandaloneMode">
        <div class="pwa-message">
          <ion-icon name="logo-apple" class="pwa-icon"></ion-icon>
          <p>Detectamos um dispositivo iOS</p>
          <p class="pwa-text-small">
            Toque em <ion-icon name="share-outline"></ion-icon> e selecione "Adicionar à Tela Inicial"
          </p>
        </div>
      </div>

    </div>

    <!-- Footer -->
    <div class="footer-section">
      <p class="footer-text">{{ author }}</p>
    </div>

  </div>

</ion-content>
